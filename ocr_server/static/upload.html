<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"> 
	<title>上传发票</title>
	<link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css">  
	<script src="https://cdn.bootcss.com/jquery/2.1.1/jquery.min.js"></script>
	<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>
<body>

<div class="container"> 
        <h1>发票上传</h1>
        <div class="form-group">
            <label for="inputfile">选择文件</label>
            <input hidden="text" name="user_id" value="2">
            <input type="file" name="user_file" accept="image/jpeg, image/png, image/jpg">
            <p class="help-block">请选择拍好的发票照片。</p>
        </div>
        <button class="btn btn-default" id="btnUpload">提交</button>
        <!-- button class="btn btn-default" id="btnShowDetail">查看</button -->
</div>
<script>
    var g_taskID = "";
    function uploadImageFile(){
        console.log("uploadImageFile");
        var urlUpload = "http://180ly66419.iok.la:5000/api/upload?1=1";
        var formData = new FormData();
        //formData.append("user_id", "2");
        formData.append("user_file", $('input[name=user_file]')[0].files[0]);
        $.ajax({
            url: urlUpload,
            type: "POST",
            data: formData,
            /**
            *必须false才会自动加上正确的Content-Type
            */
            contentType: false,
            /**
            * 必须false才会避开jQuery对 formdata 的默认处理
            * XMLHttpRequest会对 formdata 进行正确的处理
            */
            processData: false,
            success: function (data) {
                if (data.status == "true") {
                    console.log(data);
                    var oResult = JSON.parse(data.msg);
                    g_taskID = oResult.data.task_id;
                    // $("#btnShowDetail").show();
                    alert("上传成功！" + data.msg, "");
                }
                if (data.status == "error") {
                    alert(data.msg)
                }
                //$("#imgWait").hide();
            },
            error: function (jqXHR) {
                alert("失败！");
                alert(JSON.stringify(jqXHR));
                console.log(JSON.stringify(jqXHR));
                //$("#imgWait").hide();
            }
        });
    }

    $(document).ready(function(){
        $("#btnUpload").click(uploadImageFile);
    });

    function onbtnClickShowDetails(){
        var strUrlInvDetails = "invoiceDetails.html?1=1&" + oResult.data.task_id;

    }

</script>
</body>
</html>
